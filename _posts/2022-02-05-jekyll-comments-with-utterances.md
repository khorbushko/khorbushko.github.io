---
layout: post
comments: true
title: "Jekyll comments with utteranc.es"
categories: article
tags: [Jekyll, comments, utteranc.es]
excerpt_separator: <!--more-->
comments_id: 70

author:
- kyryl horbushko
- Lviv
---

My blog is built on [Jekyll](https://jekyllrb.com/) - it's a simple and easy-to-use static website. A lot of plugins can be used and added to it. One of the areas, where we can use such plugins - is comments.
<!--more-->

Out of the box [Jekyll](https://jekyllrb.com/) support [Disqus](https://blog.disqus.com/) - not a bad option, but it's a bit slow and a lot of resources needs to be loaded to show comments. Another downside - a few trackers also auto-added to your page. There is also a few discussion that exists on the web regarding Disqus and its problem like [this one](https://fatfrogmedia.com/delete-disqus-comments-wordpress/). All of this moved me to use alternatives for comments.

## The problem

My first choice was a solution proposed by [Ari Stathopoulos](https://aristath.github.io/blog/static-site-comments-using-github-issues-api) - he just uses GitHub API to fetch and display comments for a page using issues for u'r website repo.

This works fine, but I have a few comments from my friends, that such comments are not fine visible and understandable for them.

The solution, that is currently used by this blog - [utterances](https://utteranc.es/). 

This widget builds on top of GitHub issues - this is good because no migration is needed for old comments.

To implement this, we need to do only a couple of changes.

## utteranc.es

### how it works

The answer I grab from the official page:

> When Utterances loads, the [GitHub issue search API](https://developer.github.com/v3/search/#search-issues) is used to find the issue associated with the page-based on URL, pathname, or title. If we cannot find an issue that matches the page, no problem, utterances-bot will automatically create an issue the first time someone comments.
> 
> To comment, users must authorize the utterances app to post on their behalf using the GitHub OAuth flow. **Alternatively, users can comment on the GitHub issue directly.**

> [source](https://utteranc.es/)

### Integration

The full config will take about 15 min. 

There are only 3 steps needed.

**The first step** - is to add shared data to config file `_config.yml`:

{% highlight yml %}
comments:
  provider:            utterances
   
utterances:
  theme:               "github-light"  
{% endhighlight %}

**The second step** - is to create a part of the page, that will contain comments, for example, `comments.html`.

To do so, we can use a script, that can be autogenerated by utterances:

{% highlight js %}
<script src="https://utteranc.es/client.js"
        repo="[ENTER REPO HERE]"
        issue-number="[ENTER ISSUE NUMBER HERE]"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
{% endhighlight %}

The great stuff, is that utterances provide a various options for the way how to search issues at you'r git:

<div style="text-align:center">
<a href="{{site.baseurl}}/assets/posts/images/2022-02-05-jekyll-comments-with-utterances/mapping.png">
<img src="{{site.baseurl}}/assets/posts/images/2022-02-05-jekyll-comments-with-utterances/mapping.png" alt="mapping" width="450"/>
</a>
</div>
<br>
<br>

I selected an option that use issue id because previously I already use this way and in addition, all my pages contain the id in the header:

{% highlight yml %}
comments_id: 69
{% endhighlight %}

Previously, I already used Disqus and fetch comments API. In case I decided to return to prev approach, we can configure the HTML page (`comments-holder.html`) in a way, so we just update `_config.yml`, and comment system will be replaced:

{% raw %} 
	{% assign provider = site.comments.provider | default:"disqus" %}
	{% if provider == "disqus" %}
	  # code to use disqus
	{% elsif provider == "utterances" %}
	  {% assign utterances = site.utterances %}
	  {% if utterances.repo %}
	        <script src="https://utteranc.es/client.js"
	            repo="khorbushko/khorbushko.github.io"
	            issue-number={{ page.comments_id }}
	            theme={{ utterances.theme }}
	            crossorigin= "anonymous"
	            async>
	        </script>
	  {% endif %}
	{% elsif provider == "fetch" %}
	   # code to use direct fetch
	{% endif %}
{% endraw %}

**The last, third step** require modification of `post.html` - just include the page created in prev step:


{% raw %}

	{% include comments-holder.html %}
{% endraw %}


The path's for all files:

{% highlight yml %}

 # config
_config.yml
 # comments system selection component
_includes/comments-holder.html
 # post layout
_layouts/post.html
{% endhighlight %}

The result:

<div style="text-align:center">
<a href="{{site.baseurl}}/assets/posts/images/2022-02-05-jekyll-comments-with-utterances/result.png">
<img src="{{site.baseurl}}/assets/posts/images/2022-02-05-jekyll-comments-with-utterances/result.png" alt="result" width="550"/>
</a>
</div>
<br>
<br>

## Resources

* [Jekyll](https://jekyllrb.com/)
* [Disqus](https://blog.disqus.com/)
* [utterances](https://utteranc.es/)
* [Disqus problems](https://aristath.github.io/blog/static-site-comments-using-github-issues-api)
