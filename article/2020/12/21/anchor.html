<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Ahoy, captain! Give me the Anchor! | kyryl horbushko</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Ahoy, captain! Give me the Anchor!" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Building a complex UI may require data exchange between different parts of the view hierarchy. Often we may require an exact position or some coordinate point during various animation processes or even just a point." />
<meta property="og:description" content="Building a complex UI may require data exchange between different parts of the view hierarchy. Often we may require an exact position or some coordinate point during various animation processes or even just a point." />
<link rel="canonical" href="http://localhost:4000/article/2020/12/21/anchor.html" />
<meta property="og:url" content="http://localhost:4000/article/2020/12/21/anchor.html" />
<meta property="og:site_name" content="kyryl horbushko" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-21T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Ahoy, captain! Give me the Anchor!" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/article/2020/12/21/anchor.html"},"@type":"BlogPosting","url":"http://localhost:4000/article/2020/12/21/anchor.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/favicon.png"}},"headline":"Ahoy, captain! Give me the Anchor!","dateModified":"2020-12-21T00:00:00+02:00","datePublished":"2020-12-21T00:00:00+02:00","description":"Building a complex UI may require data exchange between different parts of the view hierarchy. Often we may require an exact position or some coordinate point during various animation processes or even just a point.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="shortcut icon" type="image/png" href="/assets/favicon.png"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="kyryl horbushko" />
<meta name='monetization' content='$ilp.uphold.com/GiEjnNF98h8k'>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">kyryl horbushko</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/bookNotes/">Books</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/blog/archives/">Archives</a><a class="page-link" href="/contact/">Contact</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Ahoy, captain! Give me the Anchor!</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-12-21T00:00:00+02:00" itemprop="datePublished">
        Dec 21, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">kyryl horbushko</span></span>, 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Lviv</span></span></p>

      
         
          <a class="post-tag" href="/tags/#ios">iOS</a>
         
          <a class="post-tag" href="/tags/#swiftui">SwiftUI</a>
         
          <a class="post-tag" href="/tags/#anchor">Anchor</a>
         
          <a class="post-tag" href="/tags/#geometryreader">GeometryReader</a>
         
      
         <span style="float:right;">
          <span class="ert">
    <abbr title="Estimated reading time">Estimated reading time: </abbr>
    
    
    
    

    
    
    

    
    8 minutes
</span>
         </span>
         <br>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <br>
    <ul>
  <li><a href="#anchor">Anchor</a></li>
  <li><a href="#example">Example</a></li>
  <li><a href="#consclusion">Consclusion</a></li>
</ul>
    <br>
    <p>Building a complex UI may require data exchange between different parts of the view hierarchy. Often we may require an exact position or some coordinate point during various animation processes or even just a point. 
<!--more--></p>

<p>Back in <code class="language-plaintext highlighter-rouge">UIKit</code>, everything is quite simple - we may ask <code class="language-plaintext highlighter-rouge">UIView</code> to convert values (such as frame (<code class="language-plaintext highlighter-rouge">CGRect</code>) or point (<code class="language-plaintext highlighter-rouge">CGPoint</code>)) from one coordinate system to another and send data using various mechanisms (for example delegate or closure).</p>

<blockquote>
  <p>check <em>Converting Between View Coordinate Systems</em> part of <a href="https://developer.apple.com/documentation/uikit/uiview">this official documentation</a></p>
</blockquote>

<p>If we think about <code class="language-plaintext highlighter-rouge">SwiftUI</code> - things are a bit different: we can’t use any of these mechanisms. So what we have instead? The answer is <code class="language-plaintext highlighter-rouge">Anchor</code>.</p>

<h2 id="anchor">Anchor</h2>

<p><code class="language-plaintext highlighter-rouge">Anchor</code> is just a struct, that can wrap some value - value that u want to manage and pass between view’s. The official <a href="https://developer.apple.com/documentation/swiftui/anchor">description of this</a> - <em>An opaque value derived from an anchor source and a particular view.</em></p>

<p>The declaration of this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">@frozen</span> <span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">Value</span><span class="o">&gt;</span> <span class="p">{</span>
	<span class="kd">@frozen</span> <span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Source</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Inside we also see a nested struct that represents <a href="https://developer.apple.com/documentation/swiftui/anchor/source"><code class="language-plaintext highlighter-rouge">Source</code></a> - something that generates the value that we want to pass and manipulate later. <code class="language-plaintext highlighter-rouge">Source</code> can be used within <a href="https://developer.apple.com/documentation/swiftui/geometryproxy"><code class="language-plaintext highlighter-rouge">GeometryProxy</code></a> object (using subscript mechanism).</p>

<blockquote>
  <p><a href="https://developer.apple.com/documentation/swiftui/geometryproxy"><code class="language-plaintext highlighter-rouge">GeometryProxy</code></a> can be obtained from <a href="https://developer.apple.com/documentation/swiftui/geometryreader"><code class="language-plaintext highlighter-rouge">GeometryReader</code></a>.</p>
</blockquote>

<p>Source is managed using <code class="language-plaintext highlighter-rouge">PreferenceKey</code> via special viewModifier - <code class="language-plaintext highlighter-rouge">anchorPreference</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">@inlinable</span> <span class="kd">public</span> <span class="kd">func</span> <span class="n">anchorPreference</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">,</span> <span class="kt">K</span><span class="o">&gt;</span><span class="p">(</span><span class="n">key</span> <span class="nv">_</span><span class="p">:</span> <span class="kt">K</span><span class="o">.</span><span class="k">Type</span> <span class="o">=</span> <span class="kt">K</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;.</span><span class="kt">Source</span><span class="p">,</span> <span class="nv">transform</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">A</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">K</span><span class="o">.</span><span class="kt">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="k">where</span> <span class="kt">K</span> <span class="p">:</span> <span class="kt">PreferenceKey</span></code></pre></figure>

<blockquote>
  <p>I wrote separate article about <a href="/article/2020/12/17/preferenceKey.html">PreferenceKey</a>, check it out for more.</p>
</blockquote>

<p>Removing generic parameters and constraints for simplification we can see that this view modifier requires from us a few things:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">key</code> to which value will be temporarily stored</li>
  <li><code class="language-plaintext highlighter-rouge">source</code> - where to find the value and</li>
  <li><code class="language-plaintext highlighter-rouge">transform block</code> - how to transform and represent obtained value.</li>
</ul>

<p>I would like to mention that in theory, we can pass any <code class="language-plaintext highlighter-rouge">Value</code> in the <code class="language-plaintext highlighter-rouge">Anchor</code> struct - as u already saw, there are no requirements to it. So we may want to pass our type not related to geometry, but this probably a bad coding style.</p>

<p>In case if u would like to use if for passing <code class="language-plaintext highlighter-rouge">CGRect</code> or <code class="language-plaintext highlighter-rouge">CGPoint</code>, Apple has prepared for us predefined set of possible options and operations similar to one existing in <code class="language-plaintext highlighter-rouge">UIKit</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">Anchor</span><span class="o">.</span><span class="kt">Source</span> <span class="k">where</span> <span class="kt">Value</span> <span class="o">==</span> <span class="kt">CGRect</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">rect</span><span class="p">(</span><span class="n">_</span> <span class="nv">r</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">Value</span><span class="o">&gt;.</span><span class="kt">Source</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">bounds</span><span class="p">:</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">CGRect</span><span class="o">&gt;.</span><span class="kt">Source</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Anchor</span><span class="o">.</span><span class="kt">Source</span> <span class="k">where</span> <span class="kt">Value</span> <span class="o">==</span> <span class="kt">CGPoint</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">point</span><span class="p">(</span><span class="n">_</span> <span class="nv">p</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">Value</span><span class="o">&gt;.</span><span class="kt">Source</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">unitPoint</span><span class="p">(</span><span class="n">_</span> <span class="nv">p</span><span class="p">:</span> <span class="kt">UnitPoint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">Value</span><span class="o">&gt;.</span><span class="kt">Source</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">topLeading</span><span class="p">:</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">CGPoint</span><span class="o">&gt;.</span><span class="kt">Source</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">top</span><span class="p">:</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">CGPoint</span><span class="o">&gt;.</span><span class="kt">Source</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span>
    
    <span class="o">...</span>
<span class="p">}</span></code></pre></figure>

<h2 id="example">Example</h2>

<p>The best way to understand something is by trying it.</p>

<blockquote>
  <p>As for me, I prefer to have a bit of understanding of an idea before actual coding, that’s why I put a description of how it should be used above.</p>
</blockquote>

<p>We may create a simple view with a few nested views and pass geometry between them. Code for the view will be very simple:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">AnchorView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
        
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">HStack</span> <span class="p">{</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
						<span class="c1">// action</span>
                <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"Hi"</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
                <span class="kt">Spacer</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="kt">HStack</span> <span class="p">{</span>
                <span class="kt">Spacer</span><span class="p">()</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
						<span class="c1">// action</span>
                <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="kt">Spacer</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="kt">HStack</span> <span class="p">{</span>
                <span class="kt">Spacer</span><span class="p">()</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
						<span class="c1">// action</span>
                <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"Aloha"</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<blockquote>
  <p>I added extra <code class="language-plaintext highlighter-rouge">.padding</code> on few buttons just to make changes more obvious - u will see it later.</p>
</blockquote>

<div style="text-align:center">
<img src="/assets/posts/images/2020-12-21-anchor/initialView.png" alt="initialView" width="350" />
</div>

<p><br /></p>

<p>To test <code class="language-plaintext highlighter-rouge">Anchor</code> firstly, as was mention above, we should create a <code class="language-plaintext highlighter-rouge">PreferenceKey</code> - value that can hold data for us:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">TextBoundsKey</span><span class="p">:</span> <span class="kt">PreferenceKey</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">defaultValue</span><span class="p">:</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">CGRect</span><span class="o">&gt;</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">reduce</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">CGRect</span><span class="o">&gt;</span><span class="p">?,</span> <span class="nv">nextValue</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">CGRect</span><span class="o">&gt;</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="p">??</span> <span class="nf">nextValue</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Here, we declared <code class="language-plaintext highlighter-rouge">TextBoundsKey</code> that will be used to manage <code class="language-plaintext highlighter-rouge">CGRect</code> (<code class="language-plaintext highlighter-rouge">Anchor&lt;CGRect&gt;</code>) - frame of each button.</p>

<p>Next - we can already use the preference key using the modifier described above - <code class="language-plaintext highlighter-rouge">anchorPreference</code>. To make things a bit better, we may create a <code class="language-plaintext highlighter-rouge">View</code> extension for this. Adding any input parameters that can be used for the transform block is also an option.</p>

<p>So let’s define extension with additional input - flag that can help us to decide whenever we should capture value. Also - pay attenstion to a <code class="language-plaintext highlighter-rouge">value</code> - <code class="language-plaintext highlighter-rouge">.bounds</code> used - one of predefined options from <code class="language-plaintext highlighter-rouge">Anchor&lt;CGRec&gt;</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">captureBounds</span><span class="p">(</span><span class="n">_</span> <span class="nv">shouldCaptureAnchor</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="nf">anchorPreference</span><span class="p">(</span>
            <span class="nv">key</span><span class="p">:</span> <span class="kt">TextBoundsKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span>
            <span class="nv">value</span><span class="p">:</span> <span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="c1">// &lt;-- var bounds: Anchor&lt;CGRect&gt;.Source</span>
            <span class="nv">transform</span><span class="p">:</span> <span class="p">{</span> <span class="n">anchor</span> <span class="k">in</span>
                <span class="n">shouldCaptureAnchor</span> <span class="p">?</span> <span class="nv">anchor</span> <span class="p">:</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Now, we may add logic to the view that allows us to capture coordinates of the <code class="language-plaintext highlighter-rouge">Button</code> only if we press it. To do so we need a <code class="language-plaintext highlighter-rouge">@State</code> variable for holding the index of the button and our <code class="language-plaintext highlighter-rouge">captureBounds</code> function:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">AnchorView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedItemIndex</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">HStack</span> <span class="p">{</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">selectedItemIndex</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"Hi"</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
                <span class="o">.</span><span class="nf">captureBounds</span><span class="p">(</span><span class="n">selectedItemIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="kt">Spacer</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="kt">HStack</span> <span class="p">{</span>
                <span class="kt">Spacer</span><span class="p">()</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">selectedItemIndex</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="o">.</span><span class="nf">captureBounds</span><span class="p">(</span><span class="n">selectedItemIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                <span class="kt">Spacer</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="kt">HStack</span> <span class="p">{</span>
                <span class="kt">Spacer</span><span class="p">()</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">selectedItemIndex</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"Aloha"</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
                <span class="o">.</span><span class="nf">captureBounds</span><span class="p">(</span><span class="n">selectedItemIndex</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Here u can see that whenever we press a button, the index of a button is stored and <code class="language-plaintext highlighter-rouge">captureBounds</code> receive a <code class="language-plaintext highlighter-rouge">true</code> flag, that enables <code class="language-plaintext highlighter-rouge">Anchor</code> capturing inside the transform block.</p>

<p>Now we may add action on this preference key change. Unfortunately we can’t use existing function for this <code class="language-plaintext highlighter-rouge">onPreferenceChange(perform:)</code> because its has <code class="language-plaintext highlighter-rouge">Equitable</code> requirements. To solve this, Apple has added <a href="https://developer.apple.com/documentation/swiftui/view/overlaypreferencevalue(_:_:)"><code class="language-plaintext highlighter-rouge">overlayPreferenceValue(::)</code></a>.</p>

<p>Thus we capture <code class="language-plaintext highlighter-rouge">CGRect</code>, let’s draw a rectangle using transferred value - rect around a selected button. But before adding code for this, I would like to remember how to obtain transferred value - we should use <code class="language-plaintext highlighter-rouge">GeometryReader</code> and available subscript from <code class="language-plaintext highlighter-rouge">GeometryProxy</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">subscript</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">anchor</span><span class="p">:</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">T</span> <span class="p">{</span> <span class="k">get</span> <span class="p">}</span></code></pre></figure>

<blockquote>
  <p><a href="https://developer.apple.com/documentation/swiftui/geometryproxy/subscript(_:)">doc</a></p>
</blockquote>

<p>Usage within our example may be next:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// at the end of body</span>
<span class="o">.</span><span class="nf">overlayPreferenceValue</span><span class="p">(</span><span class="kt">TextBoundsKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="kt">GeometryReader</span> <span class="p">{</span> <span class="n">geometryProxy</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">value</span> <span class="p">{</span> <span class="c1">// &lt;-- optional, so unwrap and use if exist</span>
            <span class="kt">RoundedRectangle</span><span class="p">(</span><span class="nv">cornerRadius</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">stroke</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="kt">StrokeStyle</span><span class="p">(</span><span class="nv">lineWidth</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">lineCap</span><span class="p">:</span> <span class="o">.</span><span class="n">round</span><span class="p">,</span> <span class="nv">dash</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="nv">dashPhase</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">))</span>
                <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">geometryProxy</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">geometryProxy</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">offset</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">geometryProxy</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">minX</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">geometryProxy</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">minY</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">animation</span><span class="p">(</span><span class="o">.</span><span class="n">easeIn</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span></code></pre></figure>

<p>Here the <strong>magic</strong> is in this code - <code class="language-plaintext highlighter-rouge">geometryProxy[value]</code>.</p>

<div style="text-align:center">
<img src="/assets/posts/images/2020-12-21-anchor/simple_demo.gif" alt="simple_demo" width="350" />
</div>

<p><br /></p>

<p>This is quite a simple example, and we use everything within one <code class="language-plaintext highlighter-rouge">View</code>. An example is good only for initial testing, but in real life we never gonna have such a case - instead, a more complex view tree will be used.</p>

<p>So let’s make this example a bit more realistic and so complex. To do so we may extract <code class="language-plaintext highlighter-rouge">Button</code> to separate <code class="language-plaintext highlighter-rouge">View</code> and add some additional parameter that can be moved within a <code class="language-plaintext highlighter-rouge">CGRect</code> - the color of the rectangle that is drawn around a selected button.</p>

<p>Let’s start by defining our data type for transferring <code class="language-plaintext highlighter-rouge">CGRect</code> and <code class="language-plaintext highlighter-rouge">Color</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">AnchorValue</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">rectAnchor</span><span class="p">:</span> <span class="kt">Anchor</span><span class="o">&lt;</span><span class="kt">CGRect</span><span class="o">&gt;</span>
    <span class="k">let</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span>
<span class="p">}</span></code></pre></figure>

<p>Than - modified version of preferenseKey extension that now use our data type <code class="language-plaintext highlighter-rouge">AnchorValue</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">ColoredTextBoundsKey</span><span class="p">:</span> <span class="kt">PreferenceKey</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">defaultValue</span><span class="p">:</span> <span class="kt">AnchorValue</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">reduce</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">AnchorValue</span><span class="p">?,</span> <span class="nv">nextValue</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">AnchorValue</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="p">??</span> <span class="nf">nextValue</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">captureColoredTextBounds</span><span class="p">(</span><span class="n">_</span> <span class="nv">shouldCaptureAnchor</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="nf">anchorPreference</span><span class="p">(</span><span class="nv">key</span><span class="p">:</span> <span class="kt">ColoredTextBoundsKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="nv">transform</span><span class="p">:</span> <span class="p">{</span> <span class="n">anchor</span> <span class="k">in</span>
            <span class="n">shouldCaptureAnchor</span> <span class="p">?</span> <span class="kt">AnchorValue</span><span class="p">(</span><span class="nv">rectAnchor</span><span class="p">:</span> <span class="n">anchor</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="n">color</span><span class="p">)</span> <span class="p">:</span> <span class="kc">nil</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Extracted <code class="language-plaintext highlighter-rouge">ButtonView</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">ButtonView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    
    <span class="c1">// for simplicity this type is not handled RTL and LTR</span>
    <span class="kd">enum</span> <span class="kt">Alignment</span> <span class="p">{</span> 
        
        <span class="k">case</span> <span class="n">left</span>
        <span class="k">case</span> <span class="n">center</span>
        <span class="k">case</span> <span class="n">right</span>
    <span class="p">}</span>
    
    <span class="k">let</span> <span class="nv">text</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">rectColor</span><span class="p">:</span> <span class="kt">Color</span>
    <span class="k">let</span> <span class="nv">position</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">alignment</span><span class="p">:</span> <span class="kt">ButtonView</span><span class="o">.</span><span class="kt">Alignment</span>
    <span class="kd">@Binding</span> <span class="k">var</span> <span class="nv">selectedIndex</span><span class="p">:</span> <span class="kt">Int</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">HStack</span> <span class="p">{</span>
            
            <span class="k">if</span> <span class="n">alignment</span> <span class="o">!=</span> <span class="o">.</span><span class="n">left</span> <span class="p">{</span>
                <span class="kt">Spacer</span><span class="p">()</span>
            <span class="p">}</span>
            
            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">position</span>
            <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">captureColoredTextBounds</span><span class="p">(</span><span class="n">selectedIndex</span> <span class="o">==</span> <span class="n">position</span><span class="p">,</span> <span class="nv">color</span><span class="p">:</span> <span class="n">rectColor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">alignment</span> <span class="o">!=</span> <span class="o">.</span><span class="n">right</span> <span class="p">{</span>
                <span class="kt">Spacer</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And finally, our view that uses anchorPreference:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">AnchorView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">selectedItemIndex</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">ButtonView</span><span class="p">(</span>
                <span class="nv">text</span><span class="p">:</span> <span class="s">"Hi"</span><span class="p">,</span>
                <span class="nv">rectColor</span><span class="p">:</span> <span class="o">.</span><span class="n">red</span><span class="p">,</span>
                <span class="nv">position</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">left</span><span class="p">,</span>
                <span class="nv">selectedIndex</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedItemIndex</span>
            <span class="p">)</span>
            <span class="kt">ButtonView</span><span class="p">(</span>
                <span class="nv">text</span><span class="p">:</span> <span class="s">"Hello"</span><span class="p">,</span>
                <span class="nv">rectColor</span><span class="p">:</span> <span class="o">.</span><span class="n">green</span><span class="p">,</span>
                <span class="nv">position</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">center</span><span class="p">,</span>
                <span class="nv">selectedIndex</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedItemIndex</span>
            <span class="p">)</span>
            <span class="kt">ButtonView</span><span class="p">(</span>
                <span class="nv">text</span><span class="p">:</span> <span class="s">"Aloha"</span><span class="p">,</span>
                <span class="nv">rectColor</span><span class="p">:</span> <span class="o">.</span><span class="n">blue</span><span class="p">,</span>
                <span class="nv">position</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="nv">alignment</span><span class="p">:</span> <span class="o">.</span><span class="n">right</span><span class="p">,</span>
                <span class="nv">selectedIndex</span><span class="p">:</span> <span class="err">$</span><span class="n">selectedItemIndex</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">padding</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">overlayPreferenceValue</span><span class="p">(</span><span class="kt">ColoredTextBoundsKey</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
            <span class="kt">GeometryReader</span> <span class="p">{</span> <span class="n">geometryProxy</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">value</span> <span class="p">{</span>
                        <span class="kt">RoundedRectangle</span><span class="p">(</span><span class="nv">cornerRadius</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">stroke</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="kt">StrokeStyle</span><span class="p">(</span><span class="nv">lineWidth</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">lineCap</span><span class="p">:</span> <span class="o">.</span><span class="n">round</span><span class="p">,</span> <span class="nv">dash</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="nv">dashPhase</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">))</span>
                            <span class="o">.</span><span class="nf">foregroundColor</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">frame</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">geometryProxy</span><span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">rectAnchor</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">geometryProxy</span><span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">rectAnchor</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">offset</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">geometryProxy</span><span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">rectAnchor</span><span class="p">]</span><span class="o">.</span><span class="n">minX</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">geometryProxy</span><span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">rectAnchor</span><span class="p">]</span><span class="o">.</span><span class="n">minY</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">animation</span><span class="p">(</span><span class="o">.</span><span class="n">easeOut</span><span class="p">)</span>

                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Result:</p>

<div style="text-align:center">
<img src="/assets/posts/images/2020-12-21-anchor/demo_advanced.gif" alt="demo_advanced" width="350" />
</div>
<p><br /></p>

<p>This example demonstrates a bit more complex viewTree and data.</p>

<h2 id="consclusion">Consclusion</h2>

<p>Using <code class="language-plaintext highlighter-rouge">Anchor</code>, we easily can manage the view’s, its geometry and transfer data between viewTree components. This is a very useful technique that helps us build a more complex layout.</p>

<p><a href="/assets/posts/images/2020-12-21-anchor/source/anchor.zip">download source</a></p>

  </div><a class="u-url" href="/article/2020/12/21/anchor.html" hidden></a>
</article>

<div class="prev-next">
  
    <a class="half prev" href="/article/2020/12/17/preferenceKey.html">&laquo; Passing data up the view tree in SwiftUI</a>
  
  
    <a class="half next" href="/article/2020/12/23/swiftUI-animation.html">Introduction into SwiftUI animations &raquo;</a>
  
</div>




<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: silver;">Share on: </span><div id="share-buttons">
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=http://localhost:4000/article/2020/12/21/anchor.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
    <div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=http://localhost:4000/article/2020/12/21/anchor.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/article/2020/12/21/anchor.html&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
    
    <div class="gplus" title="Share this on Google Plus" onclick="window.open('https://plus.google.com/share?url=http://localhost:4000/article/2020/12/21/anchor.html');"><svg viewBox="0 0 2304 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1437 913q0 208-87 370.5t-248 254-369 91.5q-149 0-285-58t-234-156-156-234-58-285 58-285 156-234 234-156 285-58q286 0 491 192l-199 191q-117-113-292-113-123 0-227.5 62t-165.5 168.5-61 232.5 61 232.5 165.5 168.5 227.5 62q83 0 152.5-23t114.5-57.5 78.5-78.5 49-83 21.5-74h-416v-252h692q12 63 12 122zm867-122v210h-209v209h-210v-209h-209v-210h209v-209h210v209h209z"/></svg></div>
    <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=http://localhost:4000/article/2020/12/21/anchor.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>

<script src="  https://unpkg.com/showdown/dist/showdown.min.js"></script>
<script>
const GH_API_URL = 'https://api.github.com/repos/khorbushko/khorbushko.github.io/issues/17/comments'; // ?client_id=&client_secret=

let request = new XMLHttpRequest();
request.open( 'GET', GH_API_URL, true );
request.onload = function() {
	if ( this.status >= 200 && this.status < 400 ) {
		let response = JSON.parse( this.response );

		for ( var i = 0; i < response.length; i++ ) {
			document.getElementById( 'gh-comments-list' ).appendChild( createCommentEl( response[ i ] ) );
		}

		if ( 0 === response.length ) {
			document.getElementById( 'no-comments-found' ).style.display = 'block';
		}
	} else {
		console.error( this );
	}
};

function createCommentEl( response ) {
	let user = document.createElement( 'a' );
	user.setAttribute( 'href', response.user.url.replace( 'api.github.com/users', 'github.com' ) );
	user.classList.add( 'user' );

	let userAvatar = document.createElement( 'img' );
	userAvatar.classList.add( 'avatar' );
	userAvatar.setAttribute( 'src', response.user.avatar_url );

	user.appendChild( userAvatar );

	let commentLink = document.createElement( 'a' );
	commentLink.setAttribute( 'href', response.html_url );
	commentLink.classList.add( 'comment-url' );
	commentLink.innerHTML = '#' + response.id + ' - ' + response.created_at;

	let commentContents = document.createElement( 'div' );
	commentContents.classList.add( 'comment-content' );
	commentContents.innerHTML = response.body;
	// Progressive enhancement.
	if ( window.showdown ) {
		let converter = new showdown.Converter();
		commentContents.innerHTML = converter.makeHtml( response.body );
	}

	let comment = document.createElement( 'li' );
	comment.setAttribute( 'data-created', response.created_at );
	comment.setAttribute( 'data-author-avatar', response.user.avatar_url );
	comment.setAttribute( 'data-user-url', response.user.url );

	comment.appendChild( user );
	comment.appendChild( commentContents );
	comment.appendChild( commentLink );

	return comment;
}
request.send();
</script>

<hr>

<div class="github-comments">
	<h2>Comments</h2>
	<ul id="gh-comments-list"></ul>
	<p id="leave-a-comment">Join the discussion for this article on <a href="https://github.com/khorbushko/khorbushko.github.io/issues/17">this ticket</a>. Comments appear on this page instantly.</p>
</div>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>RSS</span>      
          </a>
          &nbsp;&nbsp;
          <a href="https://feedrabbit.com/?url=http://khorbushko.github.io">
            <svg class="svg-icon black">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Newsletter</span>      
          </a>

        </p>
        <ul class="contact-list">
          <li class="p-name">khorbushko</li>
          <li><a class="u-email" href="mailto:kirill.ge@gmail.com">kirill.ge@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>inspired by &quot;software craftsmanship&quot;</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/khorbushko" title="khorbushko"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://stackoverflow.com/users/2012219" title="2012219"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/kyryl-horbushko-67936bb5" title="kyryl-horbushko-67936bb5"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
