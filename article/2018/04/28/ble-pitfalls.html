<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>BLE pitfalls | kyryl horbushko</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="BLE pitfalls" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="originally this post was written on Apr 28, 2018 and available here Abbreviations (in order of appearance): BLE- Bluetooth Low PCB — Printed circuit board API — Application Programming Interface Every developer who worked with iOS BLE knows that not everything is so good as it’s described in the documentation. And today, I would like to describe a few main points that can be tricky when working with BLE. I would like to provide some information for you, reader and I guess BLE-developer, to make your journey in Cocoa BLE world less painful and more productive." />
<meta property="og:description" content="originally this post was written on Apr 28, 2018 and available here Abbreviations (in order of appearance): BLE- Bluetooth Low PCB — Printed circuit board API — Application Programming Interface Every developer who worked with iOS BLE knows that not everything is so good as it’s described in the documentation. And today, I would like to describe a few main points that can be tricky when working with BLE. I would like to provide some information for you, reader and I guess BLE-developer, to make your journey in Cocoa BLE world less painful and more productive." />
<link rel="canonical" href="http://localhost:4000/article/2018/04/28/ble-pitfalls.html" />
<meta property="og:url" content="http://localhost:4000/article/2018/04/28/ble-pitfalls.html" />
<meta property="og:site_name" content="kyryl horbushko" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-04-28T00:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="BLE pitfalls" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/article/2018/04/28/ble-pitfalls.html"},"@type":"BlogPosting","url":"http://localhost:4000/article/2018/04/28/ble-pitfalls.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/favicon.png"}},"headline":"BLE pitfalls","dateModified":"2018-04-28T00:00:00+03:00","datePublished":"2018-04-28T00:00:00+03:00","description":"originally this post was written on Apr 28, 2018 and available here Abbreviations (in order of appearance): BLE- Bluetooth Low PCB — Printed circuit board API — Application Programming Interface Every developer who worked with iOS BLE knows that not everything is so good as it’s described in the documentation. And today, I would like to describe a few main points that can be tricky when working with BLE. I would like to provide some information for you, reader and I guess BLE-developer, to make your journey in Cocoa BLE world less painful and more productive.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="shortcut icon" type="image/png" href="/assets/favicon.png"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="kyryl horbushko" />
<meta name='monetization' content='$ilp.uphold.com/GiEjnNF98h8k'>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">kyryl horbushko</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/bookNotes/">Books</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/blog/archives/">Archives</a><a class="page-link" href="/contact/">Contact</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">BLE pitfalls</h1>
    <p class="post-meta"><time class="dt-published" datetime="2018-04-28T00:00:00+03:00" itemprop="datePublished">
        Apr 28, 2018
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">kyryl horbushko</span></span>, 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Lviv</span></span></p>

      
         
          <a class="post-tag" href="/tags/#ble">BLE</a>
         
          <a class="post-tag" href="/tags/#ios">iOS</a>
         
          <a class="post-tag" href="/tags/#utils">utils</a>
         
      
         <span style="float:right;">
          <span class="ert">
    <abbr title="Estimated reading time">Estimated reading time: </abbr>
    
    
    
    

    
    
    

    
    7 minutes
</span>
         </span>
         <br>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <br>
    <ul>
  <li><a href="#sniffer-tool">Sniffer tool</a></li>
  <li><a href="#3rd-party-apps-for-testing-api">3rd party apps for testing API</a></li>
  <li><a href="#logging">Logging</a></li>
  <li><a href="#firmware">Firmware</a></li>
  <li><a href="#status-observation">Status observation</a></li>
  <li><a href="#timeout">Timeout</a></li>
  <li><a href="#multiline-response">Multiline response</a></li>
  <li><a href="#backgrounding">Backgrounding</a></li>
  <li><a href="#references">REFERENCES</a>
    <ul>
      <li><a href="#apple-developer--core-bluetooth-programming-guides">Apple Developer — Core Bluetooth Programming Guides:</a></li>
      <li><a href="#other">Other:</a></li>
    </ul>
  </li>
</ul>
    <br>
    <blockquote>
  <p>originally this post was written on Apr 28, 2018 and available <a href="https://medium.com/@kirill.ge/cocoatouch-ble-pitfalls-9b9b92ebc739">here</a></p>
</blockquote>

<p>Abbreviations (in order of appearance):</p>

<ul>
  <li><strong>BLE</strong>- Bluetooth Low</li>
  <li><strong>PCB</strong> — Printed circuit board</li>
  <li><strong>API</strong> — Application Programming Interface</li>
</ul>

<p>Every developer who worked with iOS BLE knows that not everything is so good as it’s described in the documentation. And today, I would like to describe a few main points that can be tricky when working with BLE. I would like to provide some information for you, reader and I guess BLE-developer, to make your journey in Cocoa BLE world less painful and more productive.</p>

<!--more-->

<p>So, the very first thing you need to know is the answer to the question ”Where exactly something goes wrong — on my side or on the connected device? Does something happen when I send a command to the device?”</p>

<p>To get an answer to this question I recommend to use a few approaches:</p>

<ul>
  <li>sniffer tool</li>
  <li>3rd party apps for testing API</li>
  <li>logging</li>
  <li>firmware version of the device, with which you work without encryption or any other protection</li>
</ul>

<p>So, let’s discuss every point more details.</p>

<h2 id="sniffer-tool">Sniffer tool</h2>

<p><strong>Sniffer tool</strong> — this a tool that allows you to intersect data packets and analyze them without a CoreBluetooth framework. It can be very helpful to distinguish different aspects of BLE communication — requests, responses, unhandled error, unexpected messages, etc. To set up such tool, you basically need several things: special Ppcband firmware Mac. I used Wireshark and Nordic Semiconductors test board. Together they provide a powerful toolset for sniffing activities.</p>

<p>Sniffer tools can be used in two modes — advertisement and connection.</p>

<p>Useful links are:</p>

<ul>
  <li><a href="http://www.argenox.com/bluetooth-low-energy-ble-v4-0-development/library/ultimate-guide-to-debugging-bluetooth-smart-ble-products/">info about sniffing tools and how they work</a></li>
  <li><a href="https://www.nordicsemi.com/eng/nordic/Products/nRF52-DK/nRF-Sniffer-UG-v2/65245">sniffer-tool — nRF-Sniffer-UG</a></li>
  <li><a href="https://www.wireshark.org/">Wireshark</a></li>
  <li><a href="https://www.xquartz.org/releases/XQuartz-2.7.8.html">XQuartz (needed for some versions of Wireshark)</a></li>
</ul>

<h2 id="3rd-party-apps-for-testing-api">3rd party apps for testing API</h2>

<p>3rd party apps for testing API — one of the fastest ways to test your device is to use 3rd party solutions. With such products, you can easily scan, discover, send/receive, or even simulate some functionality of your device.</p>

<p>Great examples are:</p>

<ul>
  <li><a href="https://itunes.apple.com/us/app/lightblue-explorer/id557428110?mt=8">LightBlue</a></li>
  <li><a href="https://itunes.apple.com/us/app/silicon-labs-blue-gecko-wstk/id1030932759?mt=8">BlueGecko</a></li>
</ul>

<div style="text-align:center">
<img src="/assets/posts/images/2018-04-28-ble-pitfalls/src_1.png" alt="preview_1" width="550" />
</div>

<h2 id="logging">Logging</h2>

<p>Logging — most BLE devices talk to a smartphone on the other end. Because of this, understanding what’s happening on the phone itself can be critical. One of the most useful techniques for checking what’s happening on the phone is to use the operating system’s own logging capabilities.</p>

<p>In iOS, enabling Bluetooth logging requires installing a special profile in the device. You can find more information on enabling it at <a href="https://developer.apple.com/bluetooth/">link</a></p>

<p>Once enabled, iTunes can sync the logs to a computer and they can be analyzed.</p>

<h2 id="firmware">Firmware</h2>

<p>Firmware — to protect own product it’s common to use an encrypted protocol of communication between app and device. Such approach ensures a higher security level for a user, but at the same time is much harder in terms of development. To simplify this process, always use an unencrypted version of firmware during development and include an additional level of security only for production purposes. This, of course, affects firmware development time a little bit, but this also reduces efforts required from your side to develop a great app using such firmware.</p>

<p>At this point, I assume that development environment is up and running, and all you need is just to make your hands dirty and write some code to bring life to the app :).</p>

<p>Now, to make sure your user gets best UX you should fully control all processes inside your app and, correspondingly, all aspects of it. Basically, you should think about the following points:</p>

<ul>
  <li>Bluetooth device availability (status observation)</li>
  <li>timeout for from the connected device</li>
  <li>multiline response handling (if needed)</li>
  <li>backgrounding (if needed)</li>
  <li>multi-device connection (if needed)</li>
</ul>

<p>I won’t describe all aspects of each point in the list above, instead, I will give you some advice for them.</p>

<h2 id="status-observation">Status observation</h2>

<p>Status observation — luckily for us, iOS may work with a few devices at the same time and so with a few objects that can handle work with Bluetooth devices. And of course, we will use this possibility. One approach is to prepare a simple device scanner — this will allow you to be notified when a Bluetooth device is up and running and vise This approach is simple and effective and may be as follows:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">CoreBluetooth</span>
 
<span class="kd">final</span> <span class="kd">class</span> <span class="kt">BLEStatusObserver</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
 
    <span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Notifications</span> <span class="p">{</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="k">let</span> <span class="nv">BLEStatusObserverDidDetectBLEStatusChange</span> <span class="o">=</span> <span class="s">"BLEStatusObserverDidDetectBLEStatusChangeNotification"</span>
 
        <span class="kd">struct</span> <span class="kt">Keys</span> <span class="p">{</span>
            <span class="kd">static</span> <span class="k">let</span> <span class="nv">availability</span> <span class="o">=</span> <span class="s">"availability"</span><span class="kd">static</span> <span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="s">"message"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">observer</span> <span class="o">=</span> <span class="kt">BLEStatusObserver</span><span class="p">()</span>
 
    <span class="k">var</span> <span class="nv">isBleDeviceActive</span><span class="p">:</span><span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">currentState</span> <span class="o">==</span> <span class="o">.</span><span class="n">poweredOn</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">centralManager</span><span class="p">:</span><span class="kt">CBCentralManager</span><span class="p">?</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">currentState</span><span class="p">:</span><span class="kt">CBManagerState</span> <span class="o">=</span> <span class="o">.</span><span class="n">unknown</span>
 
    <span class="c1">// MARK: - LifeCycle</span>
 
    <span class="k">override</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
 
        <span class="n">centralManager</span> <span class="o">=</span> <span class="kt">CBCentralManager</span><span class="p">(</span><span class="nv">delegate</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">queue</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="kd">extension</span> <span class="kt">BLEStatusObserver</span><span class="p">:</span><span class="kt">CBCentralManagerDelegate</span> <span class="p">{</span>
    <span class="c1">// MARK: - CBCentralManagerDelegate</span>
 
    <span class="kd">func</span> <span class="nf">centralManagerDidUpdateState</span><span class="p">(</span><span class="n">_</span> <span class="nv">central</span><span class="p">:</span> <span class="kt">CBCentralManager</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">notificationMessage</span><span class="p">:</span><span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="n">nilswitch</span> <span class="n">central</span><span class="o">.</span><span class="n">state</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">unauthorized</span><span class="p">:</span>
                <span class="n">notificationMessage</span> <span class="o">=</span> <span class="kt">NdynamicLocalizableString</span><span class="s">"bleService.message.StatusUnathorized"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">unsupported</span><span class="p">:</span>
                <span class="n">notificationMessage</span> <span class="o">=</span> <span class="kt">NdynamicocalizableString</span><span class="p">(</span><span class="s">"bleService.message.Unsupported"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">poweredOff</span><span class="p">:</span>
                <span class="n">notificationMessage</span> <span class="o">=</span> <span class="kt">NdynamicocalizableString</span><span class="p">(</span><span class="s">"bleService.message.PowerOff"</span><span class="p">)</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">poweredOn</span><span class="p">:</span>
                <span class="n">notificationMessage</span> <span class="o">=</span> <span class="kt">NdynamicocalizableString</span><span class="p">(</span><span class="s">"bleService.message.PowerOn"</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="p">}</span>
 
        <span class="n">currentState</span> <span class="o">=</span> <span class="n">central</span><span class="o">.</span><span class="n">state</span>
 
        <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">NSNotification</span><span class="o">.</span><span class="kt">Name</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">BLEStatusObserver</span><span class="o">.</span><span class="kt">Notifications</span><span class="o">.</span><span class="kt">BLEStatusObserverDidDetectBLEStatusChange</span><span class="p">),</span> 
                                       <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">userInfo</span><span class="p">:</span> <span class="p">[</span>
                                                                    <span class="kt">Notifications</span><span class="o">.</span><span class="kt">Keys</span><span class="o">.</span><span class="nv">availability</span> <span class="p">:</span> <span class="n">central</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="o">.</span><span class="n">poweredOn</span><span class="p">,</span>
                                                                    <span class="kt">Notifications</span><span class="o">.</span><span class="kt">Keys</span><span class="o">.</span><span class="nv">message</span> <span class="p">:</span> <span class="n">notificationMessage</span> <span class="p">??</span> <span class="s">""</span>
                                                                <span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h2 id="timeout">Timeout</h2>

<p>Timeout — timeout for BLE requests is not handled by CoreBluetooth by default, so you should implement such mechanism by yourself. And here is the place where you can use all your creativity within project requirements. The only thing that I guess you need to know — yes, timeout is required.</p>

<p>Another useful point may be the knowledge of the data packet transferring speed and dependencies. Someone has already prepared tests on real devices (<a href="https://punchthrough.com/blog/posts/maximizing-ble-throughput-on-ios-and-android">like this one</a>), you may also want to check out an official Bluetooth doc (<a href="http://people.csail.mit.edu/rudolph/Teaching/Articles/BTBook.pdf">like this one</a>).</p>

<p>I suppose that this time may depend on several things:</p>

<ul>
  <li>transmitter models of your BLE devices</li>
  <li>realization of firmware (different functions may require different time to execute, on one project we have a request that may execute up to 4 sec on the device side)</li>
  <li>range from the device</li>
  <li>transmitting power</li>
</ul>

<p>Taking this into account, I suggest to start within 50–100 ms as a start point and adjust it based on your needs.</p>

<h2 id="multiline-response">Multiline response</h2>

<p>Multiline response — some firmware may return a few lines of response for specific requests (because of the packet size limitation or realization or another reason). In this case, I would like to suggest to agree on the exact protocol of communication and structure of each request/response. For example, it may be something like this:</p>

<ul>
  <li>every request should be n-bytes, with 0 on unused space</li>
  <li>every response should start/end within some symbol(s)</li>
</ul>

<p>Such approach is very simple and, believe me, very effective. If you implement this behavior, you may even have better sleep at night :)</p>

<p>One more point — make sure you execute 1 request at a time. To use such approach, NSOperationQueue may be very helpful. I will not dive into details of realization, but I want to emphasize that you should create some kind of AsyncOperation to properly handle all cases.</p>

<script src="https://gist.github.com/calebd/93fa347397cec5f88233.js"></script>

<blockquote>
  <p>note - this is just a sample</p>
</blockquote>

<h2 id="backgrounding">Backgrounding</h2>

<p>Backgrounding — this is interesting. Seriously, very interesting. You should read all available documentation, and do it again. A lot of things are tricky. I can’t describe all tricky parts here, I guess this is a question for a separate <a href="https://www.cloudcity.io/blog/2015/06/11/zero-to-ble-on-ios-part-one/">article</a>.</p>

<p>All you need to know about backgrounding within CocoaTouch — it works, but sometimes it may work not as you expected. In this case, there is only one solution — read the documentation again.</p>

<p>Huh, I guess now you can start coding :).</p>

<h2 id="references">REFERENCES</h2>

<h3 id="apple-developer--core-bluetooth-programming-guides">Apple Developer — Core Bluetooth Programming Guides:</h3>

<ul>
  <li><a href="https://developer.apple.com/bluetooth/">About bluetooth</a></li>
  <li><a href="https://developer.apple.com/library/ios/documentation/NetworkingInternetWeb/Conceptual/CoreBluetooth_concepts/AboutCoreBluetooth/Introduction.html">CoreBluetooth concepts</a></li>
  <li><a href="https://developer.apple.com/videos/wwdc/2012/#703">WWDC 2012 Videos — Core Bluetooth 101</a></li>
  <li><a href="https://developer.apple.com/videos/wwdc/2012/#705">WWDC 2012 Videos — Advanced Core Bluetooth</a></li>
  <li><a href="https://developer.apple.com/videos/wwdc/2013/#703">WWDC 2013 Videos — Core Bluetooth</a></li>
</ul>

<h3 id="other">Other:</h3>

<ul>
  <li><a href="https://www.cloudcity.io/blog/2015/06/11/zero-to-ble-on-ios-part-one/">This nice tutorial</a></li>
  <li><a href="http://www.argenox.com/bluetooth-low-energy-ble-v4-0-development/library/ultimate-guide-to-debugging-bluetooth-smart-ble-products/">Sniffer tool</a></li>
</ul>

  </div><a class="u-url" href="/article/2018/04/28/ble-pitfalls.html" hidden></a>
</article>

<div class="prev-next">
  
    <a class="half prev" href="/tutorial/2017/01/23/fastlane-for-beginners.html">&laquo; Fastlane for beginners</a>
  
  
    <a class="half next" href="/tutorial/2020/11/20/slider-component.html">Custom Slider with SwiftUI &raquo;</a>
  
</div>




<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: silver;">Share on: </span><div id="share-buttons">
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=http://localhost:4000/article/2018/04/28/ble-pitfalls.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
    <div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=http://localhost:4000/article/2018/04/28/ble-pitfalls.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/article/2018/04/28/ble-pitfalls.html&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
    
    <div class="gplus" title="Share this on Google Plus" onclick="window.open('https://plus.google.com/share?url=http://localhost:4000/article/2018/04/28/ble-pitfalls.html');"><svg viewBox="0 0 2304 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1437 913q0 208-87 370.5t-248 254-369 91.5q-149 0-285-58t-234-156-156-234-58-285 58-285 156-234 234-156 285-58q286 0 491 192l-199 191q-117-113-292-113-123 0-227.5 62t-165.5 168.5-61 232.5 61 232.5 165.5 168.5 227.5 62q83 0 152.5-23t114.5-57.5 78.5-78.5 49-83 21.5-74h-416v-252h692q12 63 12 122zm867-122v210h-209v209h-210v-209h-209v-210h209v-209h210v209h209z"/></svg></div>
    <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=http://localhost:4000/article/2018/04/28/ble-pitfalls.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>

<script src="  https://unpkg.com/showdown/dist/showdown.min.js"></script>
<script>
const GH_API_URL = 'https://api.github.com/repos/khorbushko/khorbushko.github.io/issues/5/comments'; // ?client_id=&client_secret=

let request = new XMLHttpRequest();
request.open( 'GET', GH_API_URL, true );
request.onload = function() {
	if ( this.status >= 200 && this.status < 400 ) {
		let response = JSON.parse( this.response );

		for ( var i = 0; i < response.length; i++ ) {
			document.getElementById( 'gh-comments-list' ).appendChild( createCommentEl( response[ i ] ) );
		}

		if ( 0 === response.length ) {
			document.getElementById( 'no-comments-found' ).style.display = 'block';
		}
	} else {
		console.error( this );
	}
};

function createCommentEl( response ) {
	let user = document.createElement( 'a' );
	user.setAttribute( 'href', response.user.url.replace( 'api.github.com/users', 'github.com' ) );
	user.classList.add( 'user' );

	let userAvatar = document.createElement( 'img' );
	userAvatar.classList.add( 'avatar' );
	userAvatar.setAttribute( 'src', response.user.avatar_url );

	user.appendChild( userAvatar );

	let commentLink = document.createElement( 'a' );
	commentLink.setAttribute( 'href', response.html_url );
	commentLink.classList.add( 'comment-url' );
	commentLink.innerHTML = '#' + response.id + ' - ' + response.created_at;

	let commentContents = document.createElement( 'div' );
	commentContents.classList.add( 'comment-content' );
	commentContents.innerHTML = response.body;
	// Progressive enhancement.
	if ( window.showdown ) {
		let converter = new showdown.Converter();
		commentContents.innerHTML = converter.makeHtml( response.body );
	}

	let comment = document.createElement( 'li' );
	comment.setAttribute( 'data-created', response.created_at );
	comment.setAttribute( 'data-author-avatar', response.user.avatar_url );
	comment.setAttribute( 'data-user-url', response.user.url );

	comment.appendChild( user );
	comment.appendChild( commentContents );
	comment.appendChild( commentLink );

	return comment;
}
request.send();
</script>

<hr>

<div class="github-comments">
	<h2>Comments</h2>
	<ul id="gh-comments-list"></ul>
	<p id="leave-a-comment">Join the discussion for this article on <a href="https://github.com/khorbushko/khorbushko.github.io/issues/5">this ticket</a>. Comments appear on this page instantly.</p>
</div>


      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>RSS</span>      
          </a>
          &nbsp;&nbsp;
          <a href="https://feedrabbit.com/?url=http://khorbushko.github.io">
            <svg class="svg-icon black">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Newsletter</span>      
          </a>

        </p>
        <ul class="contact-list">
          <li class="p-name">khorbushko</li>
          <li><a class="u-email" href="mailto:kirill.ge@gmail.com">kirill.ge@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>inspired by &quot;software craftsmanship&quot;</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/khorbushko" title="khorbushko"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://stackoverflow.com/users/2012219" title="2012219"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/kyryl-horbushko-67936bb5" title="kyryl-horbushko-67936bb5"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
